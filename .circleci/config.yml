# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1
# Use a package of configuration called an orb.
orbs:
  # Declare a dependency on the welcome-orb
  welcome: circleci/welcome-orb@0.4.1
# Orchestrate or schedule a set of jobs
workflows:
  # Name the workflow "welcome"
  welcome:
    # Run the welcome/run job in its own container
    jobs:
      - welcome/run
      - steps:
        # Checkout the code from the branch into the working_directory
        - checkout
        # Log the current branch
        - run:
          name: Show current branch
          command: echo ${CIRCLE_BRANCH}
        # Restore local dependencies from cache
        - restore_cache:
          keys:
            - v1-dependencies-{{ checksum "package-lock.json" }}
            - v1-dependencies-
        # Install project dependencies
        - run:
          name: Install local dependencies
          command: npm install
        # Cache local dependencies if they don't exist
        - save_cache:
          key: v1-dependencies-{{ checksum "package-lock.json" }}
          paths:
            - node_modules
        # Lint the source code
        - run:
          name: Linting
          command: npm run lint
        # Test the source code
        - run:
          name: Testing
          command: npm run test -- --no-watch --no-progress --browsers=ChromeHeadlessCI
        # End to End test
        - run:
          name: End to End Test
          command: npm run e2e -- --protractor-config=e2e/protractor-ci.conf.js

